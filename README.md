# crm

1.node_moudles存放项目所用的中间件<br/>
2.public存放了项目中页面中所用到的静态资源：css、js、image等<br/>
3.views存放了一些前端渲染的HTML文件<br/>
4.其余文件是nodejs的编写代码<br/>
<br/>
## 项目思路<br/>
1.规划路由：<br/>
~~~
| method   | path                | get参数  | post参数              | 备注                     |
|----------|---------------------|----------|----------------------|--------------------------|
| GET      | /student或/welcome  | 无       | 无                    | 首页                     |
| GET      | /student/select     | 无       | 无                    | 查询所有学生信息页面      |
| GET      | /student/insert     | 无       | 无                    | 添加学生信息页面          |
| POST     | /student/insertform | 无       | id name age sex hobby | 表单形式提交新增的学生信息 |
| POST     | /student/insertfile | 无       | file                  | 文件形式提交新增的学生信息 |
| GET      | /student/edit       | 无       | 无                    | 编辑学生信息页面          |
| POST     | /student/update     | 无       | id name age sex hobby | 提交编辑后的学生信息      |
| POST     | /student/remove     | id       | 无                    | 提交要删除的学生的id      |
~~~
<br/>
路由单独写在了一个模块里 router.js，供server.js直接调用<br/>
<br/>
2.数据操作<br/>
每一个学生的个人基本信息有一个主键就是id，id也就是学号，是每一个学生的唯一标识，通过id来对学生信息进行增删查改<br/>
这里我对学生信息的处理全部是通过对json文件数据的操作，也就需要引入中间件对数据进行操作。（当然，用数据库是最好的选择，这里只是少量数据，也就没用了）<br/>
在添加学生信息时，我提供了两种方式供用户使用，form表单提交和直接提交json文件提交。这样用户可以一次性提交多个学生信息，不用一个一个添加。（用json文件形式提交我遇到了一个弊端，出现了回调地狱，应用promise改写）<br/>
在数据操作之后，我通过服务端对前端页面进行了重定向<br/>
3.学生数据操作的方法封装<br/>
学生数据操作可呢嗯不仅仅只调用一次就行了，可能会被多次使用。多次使用的话，你的代码量会增加，从而代码维护起来更加困难，显得很冗余。因此需要将学生的增删查改这四个方法进行一一的封装。我封装了一个student.js。里面写好了增删查改的方法，在router.js模块中引入操作方法的模块即可直接使用。<br/>
4.nodejs起服务<br/>
在server.js里面开启服务，并且配置好要使用中间件的配置项，把静态资源文件公开，将配好的路由模块导入。<br/>
<br/>

## 项目细节<br/>
1.模块化<br/>
将各个功能模块化封装，这样的话更加利于后期代码的维护，看起来也舒服很多<br/>
2.添加文件数据<br/>
(1)将获取到的文件改名，获取到的文件名时二进制的名称，通过req.files[0].originalname方法获得上传的文件名，然后通过rename方法将名字改为用户上传的文字的名字。<br/>
(2)读取保存数据的文件db.js以及用户上传的数据文件<br/>
(3)将两个数据转换为数组，用数组合并的方法concat合并数据就达到了添加作用，然后将合并的数据覆盖写到db.json上<br/>
(4)最后就是将用户上传的数据给删了，留着也没用了<br/>
(5)最后将数据重定向渲染到页面中即可完成<br/>
<br/>

## 增补功能<br/>
1.增加了注册登陆模块：注册和登陆的切换用的是前端重定向<br/>
2.增加了数据库存储登陆用户信息<br/>
3.注册和登陆的表单信息提交用的是自己封装的ajax，交互信息格式为{"ok":true/false, "message":""}，ok表示注册或登陆是否成功，message表示信息。<br/>
4.登陆成功后页面的渲染是前端做的，由于后端渲染的话，用户无法得到提示信息，所以前端做渲染更好。<br/>
5.用到了中间件express-session存储登陆信息，保持登录状态<br/>
6.定义了一个全局变量，判断用户是否已经登陆，没有登陆的话智能访问主页和注册登录页面，其余页面访问全都是重定向登陆页面<br/>
7.新增路由模块：<br/>
~~~
| method   | path                | get参数  | post参数              | 备注                     |
|----------|---------------------|----------|----------------------|--------------------------|
| GET      | /login              | 无       | 无                    | 登陆页面                 |
| POST     | /login              | 无       | user password email   | 提交登陆表单信息          |
| GET      | /register           | 无       | 无                    | 注册页面                 |
| POST     | /register           | 无       | user password remeber | 提交注册信息             |
~~~

